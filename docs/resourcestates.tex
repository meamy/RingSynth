\documentclass{article}

\usepackage[utf8]{inputenc}
\usepackage{amsfonts}
\usepackage{amsmath}
\usepackage{amsthm}
\usepackage{braket}
\usepackage{qcircuit}
\theoremstyle{definition}
\newtheorem{definition}{Definition}
\theoremstyle{theorem}
\newtheorem{theorem}{Theorem}
\newtheorem{lemma}{Lemma}
\newtheorem{corollary}{Corollary}
\newtheorem{conjecture}{Conjecture}
\theoremstyle{remark}
\newtheorem{remark}{Remark}

\title{A note on approximating resource states}

\begin{document}
\maketitle

This is a very short note on upper-bounds for the resources required to prepare a resource state $\ket{\alpha}$ for a given algebraic integer $\alpha$. Here we take the approach of embedding some $\alpha\notin\mathbb{D}[i, \sqrt{2}]$ into $\mathbb{D}[i, \sqrt{2}]$, as this should in the majority of cases give the most efficient embedding into an \emph{a priori} fault-tolerant gate set. Note that in the non-fault-tolerant case the situation is different, as we generally don't care about the particular ring we're working in and have access to gets generically over $\mathbb{C}$.

\section{General case}

Supose we have a tower of embeddable extensions $E=R[\alpha_1,\dots,\alpha_k]$ where $R=\mathbb{D}[i, \sqrt{2}]$ such that there exists an $m$-qubit embedding $\rho$ of $E$ into $R$. We write $\alpha=(\alpha_1,\dots,\alpha_k)$ and use the multi-index $\alpha^j$ to denote $\alpha_1^{j_1}\cdots \alpha_k^{j_k}$. Recall that if
\[
	U = \sum \alpha^j A_{j}
\]
then 
\[
	U'=\rho(U)=\sum\Gamma^j\otimes A_j
\]
where $\Gamma=(\Gamma_1,\dots,\Gamma_k)\in U(R,2^m)^k$ pair-wise commutes. As Andrew pointed out, $\Gamma$ is simultaneously diagonalizable, and in particular there exists a simultaneous eigenvector $\Gamma\ket{\alpha} = \alpha\ket{\alpha}$ such that
\[
	U'\ket{\alpha}\ket{\phi} 
		= (\sum\Gamma^j\otimes A_j)\ket{\alpha}\ket{\phi} 
		= \ket{\alpha}\otimes (\sum\alpha^jA_j)\ket{\phi} 
		= \ket{\alpha}\otimes U\ket{\phi}.
\]

As $\ket{\alpha}$ will not generally take values in $R$, it will be necessary to approximate it. In principle we can directly approximate the resource state $\ket{\alpha}$, but a simple solution is to diagonalize $\Gamma$ as $V\Lambda V^\dagger$ and approximate $V$. In particular, we have $(V\otimes U')\ket{0}\otimes\ket{\phi} = \ket{\alpha}\otimes U\ket{\phi}$ with error (approximating $V$ with $W\in U(R,2^m)$) $||(U'\otimes(V - W))\ket{0}\otimes\ket{\phi}||$ bounded as expected by the operator norm $||V - W||$.

We obtain a simple upper bound on the Clifford+$T$ resources needed to approximate $V$ to within $\epsilon$ error by decomposing $V$ as a circuit over $CNOT$ and single-qubit unitaries. M\"ott\"onen \textit{et al.} \cite{general} give an optimal decomposition using $4^n-2^{n+1}$ $CNOT$ gates and $4^n$ single-qubit unitaries. Using the approximation of Ross and Selinger \cite{zrot} we can approximate the resulting circuit to an overall error of at most $\epsilon$ by approximating each single-qubit gate with error $\frac{\epsilon}{4^m}$, giving an overall $T$ count of
\[
	4^m(9\log_2(4^n/\epsilon) + O(\log(\log(4^n/\epsilon)))) = 4^m(18n + 9\log_2(1/\epsilon) + O(\log(\log(4^n/\epsilon)))).
\]
The bulk of the overhead is dominated by the number of single-qubit unitaries in the decomposition of $V$. Given a particular ring $E$, this isn't terrible as the cost is fixed, but for circuits such as the QFT which require larger embeddings as $n$ grows the cost is likely intractable. Either efficient multi-qubit approximations are needed or otherwise a way of concatenating eigenvectors.

\subsection{Specific cases}

For specific cases we can do better with optimal decompositions and approximations. For a single-qubit embedding, we can approximate a resource state with $3$ $z$-rotations, giving an overhead of $9\log_2(1/\epsilon) + O(\log(\log(1/\epsilon)))$ $T$-gates as per \cite{zrot}. Similarly for two-qubit embeddings, an optimal decomposition into $R_Y$ and $R_Z$ gates is known using $15$ single-qubit unitaries, or at most $19$ $z$-rotations specifically for an overhead of 
\[
	19(3\log_2(19/\epsilon) + O(\log(\log(19/\epsilon)))) \leq 285 + 57\log_2(1/\epsilon) + O(\log(\log(19/\epsilon))))
\]
$T$-gates. It may be possible to reduce this further by swapping $z$ and $y$ rotations in the decomposition, or by decomposing $y$ rotations with fewer $z$ rotations.

\section{Concatenated approximations}

Rather than perform simultaneous diagonalization and approximate a simultaneous eigenvector $\ket{\alpha}=\ket{\alpha_1\alpha_2\dots\alpha_k}$, we can instead \emph{concatenate} our approximations by alternating embedding with approximation in the ring $R$. In particular, consider the case of $k=2$. For $E=R[\alpha_1,\alpha_2]$ and $U$ a $2^n\times 2^n$ unitary over $E$, we first construct the embedding $U'$ over $R[\alpha_1]$ and diagonalize $\Gamma_2=\rho_2(\alpha_2)\in U(R[\alpha_1])$ as $V_2\Lambda_2V_2^\dagger$ such that
\[
	U'(V_2\otimes I_{2^n})\ket{0}^{\otimes m_2}\otimes\ket{\phi} = U'\ket{\alpha_2}\otimes\ket{\phi} = \ket{\alpha_2}\otimes U\ket{\phi}
\]

If we approximate $V_2$ with $W_2$ over $R$, then we have $\rho(W_2\otimes I_{2^n}) = I_{m_1}\otimes W_2\otimes I_{2^n}$ and hence
\[
	\rho_1(U'(W_2\otimes I_{2^n})) = U''(I_{m_1}\otimes W_2\otimes I_{2^n})
\]

Again we diagonalize $\Gamma=\rho_1(\alpha_1)$ as $V_1\Lambda_1 V_1^\dagger$ such that
\begin{align*}
	U''(I_{m_1}\otimes W_2\otimes I_{2^n})(V_1\otimes I_{m_2}\otimes I_{2^n})\ket{0}\otimes\ket{\psi} 
		&= U'\ket{\alpha_1}\otimes\ket{\psi}  \\
		&= \ket{\alpha_1}\otimes U'(W_2\otimes I_{2^n})\ket{\psi}
\end{align*}
if we set $\ket{\psi} = \ket{0}\otimes\ket{\phi}$ we have
\[
	U''(I_{m_1}\otimes W_2\otimes I_{2^n})(V_1\otimes I_{m_2}\otimes I_{2^n})\ket{0}\otimes\ket{0}\otimes\ket{\phi} \sim \ket{\alpha_1}\otimes\ket{\alpha_2}\otimes U\ket{\phi}
\]
as desired.

It turns out that this construction works \emph{without} interleaving approximation as well -- in particular, that $\ket{\alpha_1}\cdots\ket{\alpha_k}$ where \emph{each $\alpha_i$ is an eigenvector of $\Gamma_i$ in $R[\alpha_1,\dots,\alpha_{i-1}]$} satisfies
\[
	\rho(U)\ket{\alpha_1}\cdots\ket{\alpha_k}\otimes \ket{\phi} = \ket{\alpha_1}\cdots\ket{\alpha_k}\otimes U\ket{\phi}
\]

\begin{lemma}
Let $\rho$ be a $2^m$-embedding of $E=R[\alpha_1,\dots,\alpha_{k}]$ into $R$ such that $\rho=\rho_1\circ\cdots\circ\rho_k$ where each $\rho_i$ embeds $R[\alpha_1,\dots,\alpha_{i-1},\alpha_{i}]$ into $R[\alpha_1,\dots,\alpha_{i-1}]$. If $\ket{\alpha_i}$ is an $\alpha_i$-eigenvector for $\rho_i(\alpha_i)$, then for any unitary $U$ over $E$ and unit vector $\ket{\phi}$,
\[
	\rho(U)\ket{\alpha_1}\cdots\ket{\alpha_k}\ket{\phi} = \ket{\alpha_1}\cdots\ket{\alpha_k}(U\ket{\phi})
\]
\end{lemma}
\begin{proof}
We proceed inductively on $k$. If $k=1$ then we have $U = \sum \alpha_1^j A_{j}$ and moreover $\rho(U)=\sum\rho_1(\alpha_1)^j\otimes A_j$. Then
\begin{align*}
	\rho(U)\ket{\alpha_1}\ket{\phi}
		&=(\sum\rho_1(\alpha_1)^j\otimes A_j)\ket{\alpha_1}\ket{\phi} \\
		&=\sum \alpha_1^j\ket{\alpha_1}\otimes A_j\ket{\phi} \\
		&=\ket{\alpha_1}\otimes \sum \alpha_1^j A_j\ket{\phi} \\
		&=\ket{\alpha_1}(U\ket{\phi})
\end{align*}

Now suppose $k>1$. Let $\rho_0=\rho_1\circ\cdots\rho_{k-1}$. Then we have $U = \sum \alpha_k^j A_{j}$ for some $A_{j}$ in $R[\alpha_1,\dots,\alpha_{k-1}]$ and moreover, 
\[ 
	\rho(U)=\rho_0\circ\rho_k(U) = \rho_0(\sum\rho_k(\alpha_k)^j\otimes A_j).
\]
Hence we can observe by induction that
\begin{align*}
	\rho(U)\ket{\alpha_1}\cdots\ket{\alpha_k}\ket{\phi}
		&= \rho_0(\sum\rho_k(\alpha_k)^j\otimes A_j)\ket{\alpha_1}\cdots\ket{\alpha_{k-1}}(\ket{\alpha_k}\ket{\phi}) \\
		&= \ket{\alpha_1}\cdots\ket{\alpha_{k-1}}(\sum\rho_k(\alpha_k)^j\otimes A_j\ket{\alpha_k}\ket{\phi}) \\
		&=\ket{\alpha_1}\cdots\ket{\alpha_{k-1}}(\ket{\alpha_k}\sum\alpha_k^j\otimes A_j\ket{\phi}) \\
		&=\ket{\alpha_1}\cdots\ket{\alpha_k}(U\ket{\phi})
\end{align*}
\end{proof}

As a corollary to the above lemma, we see that $U\ket{\phi}$ can be computed using the resource state $(V_1\otimes\cdots\otimes V_k)\ket{0}^\otimes m$, where each $V_i$ is a $2^{m_i}$ by $2^{m_i}$ unitary diagonalizing $\rho_i(\alpha_i)$, and $m = \sum_{i=1}^k m_i$. To approximate $U$ with accuracy $\epsilon$, each $V_i$ needs to be approximated up to error $\epsilon/k$, giving linear overhead when each $m_i$ is at most $c$ for any constant $c$.

\section{The Quantum Fourier Transform}

The Quantum Fourier Transform is a classic example of an operation which requires approximation to implement in (most) fault-tolerant settings. In particular, for a QFT on $n$ qubits, $n-k+1$ controlled $z$-rotations of angle $\frac{2\pi i}{2^k}$ are needed for any $2\leq k \leq n$. Typically, this would be implemented by writing each controlled $z$-rotation as three half-angle $z$-rotations -- i.e. $3(n-k+1)$ rotations of angle $\frac{2\pi i}{2^{k+1}}$ -- and approximating angles with $k+1>8$ over Clifford+$T$. Here we briefly consider the resources required to instead embed each controlled $z$-rotation into Clifford+$T$.

While in principle better embeddings are possible for many of the power of two angles involved in the QFT, we use the straightforward tower of embeddings $\mathbb{D}[\sqrt{2},i,\zeta_{2^3},\dots,\zeta_{2^n}]$ where each  $\zeta_{2^i}$ has the $2$-embedding into $\mathbb{D}[\sqrt{2},i,\zeta_{2^3},\dots,\zeta_{2^{i-1}}]$ given by
\[
	\rho_i(\zeta_{2^i}) = \begin{bmatrix} 0 & \zeta_{2^{i-1}} \\ 1 & 0 \end{bmatrix}.
\]
The resulting embedding uses a total of $n-2$ ancillas, as the controlled-$T$ gate requires either a single ancilla to implement, or to decomposed as $3$ order $16$ rotations. To prepare a resource state, $n-3$ single-qubit unitaries are needed, giving an approximation overhead of something like
\[
	9n\log_2(1/\epsilon) + O(\log_2(n) + \log(\log((n)/\epsilon)))
\]
$T$ gates. This is compared to the standard case requiring the approximation (if controlled-$T$ is implemented with an ancilla) of
\begin{align*}
	\sum_{k=4}^n n-k+1 
		&= \sum_{i=1}^{n-3} i \\
		&= \frac{n(n+1)}{2} - 1 - n - (n-1) - (n-2) \\
		&= \frac{n^2 -5n + 4}{2}
\end{align*}
controlled $z$-rotations, for a total approximation overhead of something like
\[
	\left(\frac{n^2 -5n + 4}{2}\right)9\log_2(1/\epsilon) + O(\log_2(n) + \log(\log((n)/\epsilon)))
\]
probably. This crosses over somewhere around $23$ qubits.

We also get additional overhead associated with the actual embedding of the QFT circuit. Unlike the standard fault-tolerant case however, we can embed the controlled $z$-rotations directly into clifford+$T$. I'll write down an explicit construction at some point, but basically each controlled $2^k$-rotation can be implemented as two $~k$ controlled Toffoli gates and a $T$ gate.

\begin{thebibliography}{9}

\bibitem{twoqubit} Farrokh Vatan and Colin Williams, \emph{Optimal Quantum Circuits for General Two-Qubit Gates}. arXiv:quant-ph/0308006.

\bibitem{general} Mikko M\"ott\"onen, Juha J. Vartiainen, Ville Bergholm, and Martti M. Salomaa \emph{Quantum circuits for general multi-qubit gates}. arXiv:quant-ph/0404089.

\bibitem{zrot} Neil J. Ross and Peter Selinger, \emph{Optimal ancilla-free Clifford+T approximation of z-rotations}. arXiv:1403.2975.

\end{thebibliography}

\end{document}